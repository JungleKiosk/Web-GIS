<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet"
            href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
            integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
            crossorigin />
        <!-- CSS leaflet from CDN -->
        <link rel="stylesheet" href="./measure_lib/leaflet-measure.css">
        <link rel="stylesheet" href="./markerCluster_lib/MarkerCluster.css">
        <link rel="stylesheet"
            href="./markerCluster_lib/MarkerCluster.Default.css">
        <link rel="stylesheet"
            href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
        <title>Web-GIS</title>

        <!-- style page -->
        <style>
            body{
                background-color: black;
                color: greenyellow;
            }
            #map{
                width: 100%;
                height: 700px;
            }
        </style>

    </head>
    <body>

        <h1>Hello Leaflet</h1>
        <div id="map"></div>
        <!-- button onclik full screen map -->
        <button onclick=fullScreenview()> View in full screen </button>
        <h3 class="lat"></h3>
        <h3 class="lng"></h3>
        <!-- <button class="print_map">Print map</button> -->
        <button class="zoom_to_layer">Zoom to point</button>
        <h2>reference coordinates: 37.922060 12.362527</h2>
    </body>
</html>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin></script>
<!-- JS leaflet from CDN  -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
    integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<!-- jquery from CDN-->
<script
    src="./node_modules/leaflet.browser.print/dist/leaflet.browser.print.min.js"></script>
<!-- import library from terminal: npm install --save leaflet.browser.print-->
<script src="./measure_lib/leaflet-measure.js"></script>
<!-- import library leaflet-measure -->
<script src="./data/markers.js"></script>
<!-- import data test -->
<script src="./markerCluster_lib/leaflet.markercluster.js"></script>
<!-- import JS markerCluster -->
<script
    src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
<!-- import JS Geocoder -->

<script>
    /* ------------- */
    /* create a map in the 'map' div, add tiles of our choice, and then add a marker with some text in a popup */
    /* map class initialize */
    var map = L.map('map').setView([37.922060, 12.362527], 13);
    /* ------------- */
    /* position zoomControl */
    map.zoomControl.setPosition("topright")
    /* ------------- */
    /* adding tilelayer */ 
    /* https://leaflet-extras.github.io/leaflet-providers/preview/ */

    /* OMS */
    var oms = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    /* TopoMap */
    var OpenTopoMap = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
	maxZoom: 17,
	attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
    });

    /* CyclOSM */
    var CyclOSM = L.tileLayer('https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png', {
	maxZoom: 20,
	attribution: '<a href="https://github.com/cyclosm/cyclosm-cartocss-style/releases" title="CyclOSM - Open Bicycle render">CyclOSM</a> | Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    });
    /* ------------- */
    /* adding marker in the center of map */
    var refMarker = L.marker([37.922060, 12.362527])
        .bindPopup('Cala Rossa <br> My favorite place')
        .openPopup();
    /* ------------- */
    /* add map scale: down on left on page = scale({position: "bottomright"})*/
    L.control.scale().addTo(map)
    /* ------------- */
    /* function full screen map view onclick */
    var mapId = document.getElementById('map') /* take DOM element by id */
    function fullScreenview(){
        mapId.requestFullscreen();
    }
    /* ------------- */
    /* map coordinate display (jquery) */
    map.on('mousemove',function(e){
        /* console.log(e); */
        /* by moving the mouse on the map page,
        the JS objects containing the geographical
        coordinates will appear in the console */
        $('.lat').html(`lat: ${e.latlng.lat}`)/* backtick to template literal */
        $('.lng').html(`lng: ${e.latlng.lng}`)/* backtick to template literal */
    })
    /* ------------- */
    /* Print map (jquery) */
    $('.print_map').click(function(){
        window.print()
    })

        /* the map window print is not responsive */
        /* import plug-in with npm install --save leaflet.browser.print
        from terminal */
        /* TNKU_veryMuch✨: https://github.com/Igor-Vladyka/leaflet.browser.print */

    L.control.browserPrint().addTo(map);/* it's also possibile to save map in PDF */
    /* ------------- */
    /* measure on map */

        /* import plug-in Leaflet.Measure
        from terminal */
        /* TNKU_veryMuch✨: https://github.com/ptma/Leaflet.Measure*/
 
        /* other option:
        https://ppete2.github.io/Leaflet.PolylineMeasure/
        */

    // add control to map
    L.control.measure().addTo(map);

    // using action directly
    var measureAction = new L.MeasureAction(map, {
        model: "distance", // 'area' or 'distance', default is 'distance'
    });
    // measureAction.setModel('area');
    measureAction.enable();
    /* ------------- */
    /* Load geoJSON from data file JS */
    var marker = L.markerClusterGroup();

    var taji = L.geoJSON(data, {
        onEachFeature: function(features, layer){
            layer.bindPopup()
        }
    });

    taji.addTo(marker);
    /* marker.addTo(map); */
    /* ------------- */
    /* search bar Geocoder */
    /* TNKU_veryMuch✨: https://github.com/perliedman/leaflet-control-geocoder */
    L.Control.geocoder().addTo(map);
    /* ------------- */
    var baseMaps = {
        'OMS': oms,
        'TopoMap': OpenTopoMap,
        'CyclOSM': CyclOSM,
    }

    var overLayMaps = {
        'GeoJSON_Markers': marker,
        'Reference_Marker': refMarker,
    }
    
    L.control.layers(baseMaps, overLayMaps).addTo(map)
    /* ------ */
    /* zoom to layer */
    /* jquery function */
    $('.zoom_to_layer').click(function(){
        map.setView([37.922060, 12.362527])
    })


</script>